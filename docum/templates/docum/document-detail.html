{% extends "base_blank.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
<title>{{doc.title}}</title>
{% endblock title %}

{% block page_header %}
<!-- Page Header -->
<div class="page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-10">
                <ul class="page-header-breadcrumb">
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="{% url 'documents' %}">Documents</a></li>
                    <li>{{doc.title}}</li>
                </ul>
                <h1>{{doc.title}}</h1>
            </div>
        </div>
    </div>
</div>
<!-- /Page Header -->

<!-- Page Header -->
<div id="post-header" class="page-header">
    <div class="background-img" style="background-image: url({{doc.image.url}});"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-10">
                <div class="post-meta">
                    <a class="post-category cat-2"
                        href="{% url 'catago-list' doc.catago.slug %}">{{ doc.catago.title }}</a>
                    <a class="post-category cat-3">{{ doc.get_species_display }}</a>
                    <span class="post-date">{{ doc.date_posted|date:"F d, Y" }}</span>
                </div>
                <h1>{{ doc.title }}</h1>
            </div>
        </div>
    </div>
</div>
<!-- /Page Header -->
{% endblock page_header %}

{% block body %}
<div class="col-md-8">
    <!-- post -->

    <figure class="figure-img">
        <img class="img-responsive" src="{{ doc.image.url }}" alt="">
        <figcaption>{{ doc.updated_at }}</figcaption>
    </figure>

    <!-- facebook like -->
    <div class="fb-like" data-href="http://127.0.0.1:8000/document/{{doc.slug}}/" data-width="" data-layout="standard"
        data-action="like" data-size="large" data-share="true"></div>
    <!-- /facebook like -->

    <p><a class='like-btn' data-href='{{ doc.get_api_like_url }}' data-likes='{{ doc.like.count }}'
            href='{{ doc.get_like_url }}'>{{ doc.like.count }} Like</a></p>

    <p>{{ doc.content|safe|linebreaks }}</p>

    <div class="text-center">

        {% if user.is_authenticated %}

        {% if ord.exists and ord != None %}
        <a class="btn btn-success btn-lg" href="{{ doc.link_url }}" target="_blank"><i class="fas fa-download"></i>
            Download</a>
        {% else %}

        {% if doc.credit >= 1 %}
        <a class="btn btn-success btn-lg" href="{% url 'buy-item' doc.slug %}">Buy Now: {{ doc.credit }} Coin</a>
        {% else %}
        <a class="btn btn-success btn-lg" href="{% url 'buy-item' doc.slug %}"><i class="fas fa-download"></i>Download
            for free</a>
        {% endif %}

        {% endif %}

        {% else %}
        <h4>You have to login to download</h4>
        <a class="btn btn-primary btn-lg" href="{% url 'login' %}?next={{ request.get_full_path|urlencode }}">Login Now</a>
        {% endif %}
    </div>

    <!-- /post -->


    {% if user.is_authenticated %}
    <!-- comments -->
    <div class="row">
        <hr>
        <div class="section-title">
            <h2>{{doc.comments.count}} Comments</h2>
        </div>
        {% for comment in doc.comments.all %}
        <div class="post-comments">
            <!-- comment -->
            <div class="media">
                <div class="media-body">
                    <div class="media-heading">
                        <h4>{{ comment.user }}</h4>
                        <span class="time">{{ comment.create_at }}</span>
                    </div>
                    <p>{{ comment.body|linebreaks|safe }}</p>
                </div>
            </div>
            <!-- /comment -->
        </div>
        {% endfor %}
        <form action="{% url 'doc-detail' doc.slug %}" method="POST">
            {% csrf_token %}
            {{ form|crispy }}
            <input class="btn btn-primary btn-lg" type="submit" value="Comment">
        </form>
    </div>
    <!-- /comments -->
    
    {% else %}
    <div class="row">
        <hr>
        <div class="alert alert-info" role="alert">
            You must be <a href="{% url 'login' %}?next={{ request.get_full_path|urlencode }}">Login</a> to comment
        </div>
    </div>
    {% endif %}
    
    <!-- comment -->
    <div class="row">
        <hr>
        <div class="fb-comments" data-href="http://127.0.0.1:8000/document/{{doc.slug}}/" data-order-by="reverse_time"
        data-numposts="5" data-width="100%">
        </div>
    </div>
    <!-- /comment -->
</div>
{% endblock body %}

    